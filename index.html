<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SciMentor | Academic Hub</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Plus Jakarta Sans', sans-serif;
            background-color: #0F172A;
            color: #E2E8F0;
        }
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .animate-fade-in {
            animation: fadeIn 0.4s ease-out forwards;
        }

        .chat-bubble-user {
            background: #4F46E5;
            border-bottom-right-radius: 0;
        }
        .chat-bubble-bot {
            background: #1E293B;
            border-bottom-left-radius: 0;
            border: 1px solid rgba(51, 65, 85, 0.5);
        }
        .sidebar-active {
            background: rgba(79, 70, 229, 0.1);
            color: #818CF8;
            border: 1px solid rgba(79, 70, 229, 0.2);
        }
    </style>
</head>
<body class="h-screen overflow-hidden">

    <div class="flex h-screen">
        <!-- SIDEBAR -->
        <aside id="sidebar" class="fixed lg:relative z-50 h-full bg-[#1E293B] border-r border-slate-700/50 transition-all duration-300 shadow-2xl w-72">
            <div class="flex flex-col h-full p-6">
                <!-- Logo -->
                <div class="flex items-center gap-3 mb-12">
                    <div class="bg-gradient-to-br from-indigo-500 to-emerald-500 p-2.5 rounded-xl text-white shadow-lg">
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M22 10v6M2 10l10-5 10 5-10 5z"/><path d="M6 12v5c3 3 9 3 12 0v-5"/></svg>
                    </div>
                    <span class="text-xl font-bold tracking-tight text-white sidebar-text">Sci<span class="text-emerald-400">Mentor</span></span>
                </div>

                <!-- Nav -->
                <nav class="space-y-2 flex-1">
                    <button class="w-full flex items-center gap-4 px-4 py-3.5 rounded-xl transition-all sidebar-active">
                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="m3 9 9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/><polyline points="9 22 9 12 15 12 15 22"/></svg>
                        <span class="text-sm font-semibold sidebar-text">Dashboard</span>
                    </button>
                    <button class="w-full flex items-center gap-4 px-4 py-3.5 rounded-xl text-slate-400 hover:bg-slate-800 hover:text-slate-200 transition-all">
                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="1"/><path d="M20.2 20.2c2.04-2.03.02-7.36-4.5-11.9s-9.87-6.54-11.9-4.5c-2.04 2.03-.02 7.36 4.5 11.9s9.87 6.54 11.9 4.5Z"/><path d="M15.7 15.7c4.52-4.54 6.54-9.87 4.5-11.9-2.03-2.04-7.36-0.02-11.9 4.5s-6.54 9.87-4.5 11.9c2.03 2.04 7.36 0.02 11.9-4.5Z"/></svg>
                        <span class="text-sm font-semibold sidebar-text">Physics Lab</span>
                    </button>
                    <button class="w-full flex items-center gap-4 px-4 py-3.5 rounded-xl text-slate-400 hover:bg-slate-800 hover:text-slate-200 transition-all">
                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 2v8L4.72 20.55a1 1 0 0 0 .9 1.45h12.76a1 1 0 0 0 .9-1.45L14 10V2"/><path d="M8.5 2h7"/><path d="M7 16h10"/></svg>
                        <span class="text-sm font-semibold sidebar-text">Chemistry Wing</span>
                    </button>
                </nav>

                <!-- Profile -->
                <div class="mt-auto pt-6 border-t border-slate-700/50 flex items-center gap-3">
                    <div class="w-10 h-10 rounded-full bg-slate-800 flex items-center justify-center text-slate-500 border border-slate-700">
                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2"/><circle cx="12" cy="7" r="4"/></svg>
                    </div>
                    <div class="flex flex-col sidebar-text">
                        <span class="text-xs font-bold text-white uppercase tracking-wider">VITB-2025</span>
                        <span class="text-[10px] text-emerald-500 font-bold uppercase tracking-widest">Connected</span>
                    </div>
                </div>
            </div>
        </aside>

        <!-- MAIN CONTENT -->
        <main class="flex-1 flex flex-col min-w-0 relative bg-gradient-to-br from-[#0F172A] to-[#1E293B]">
            <!-- Header -->
            <header class="px-8 py-6 flex items-center justify-between border-b border-slate-800/50 bg-[#0F172A]/50 backdrop-blur-md">
                <div class="flex items-center gap-4">
                    <button id="toggle-sidebar" class="p-2 hover:bg-slate-800 rounded-lg lg:hidden text-slate-400">
                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="3" y1="12" x2="21" y2="12"/><line x1="3" y1="6" x2="21" y2="6"/><line x1="3" y1="18" x2="21" y2="18"/></svg>
                    </button>
                    <div>
                        <h2 class="text-2xl font-bold text-white tracking-tight">Academic Hub ðŸ‘‹</h2>
                        <p class="text-sm text-slate-400 font-medium">Ready for your session?</p>
                    </div>
                </div>
                <button id="clear-chat" class="p-3 text-slate-500 hover:text-rose-400 hover:bg-rose-500/10 rounded-xl transition-all">
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M3 6h18"/><path d="M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6"/><path d="M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2"/><line x1="10" y1="11" x2="10" y2="17"/><line x1="14" y1="11" x2="14" y2="17"/></svg>
                </button>
            </header>

            <!-- Chat Area -->
            <div id="chat-container" class="flex-1 overflow-y-auto px-8 py-4 space-y-8 no-scrollbar">
                <!-- Welcome State -->
                <div id="welcome-screen" class="max-w-4xl mx-auto py-10">
                    <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4">
                        <button onclick="handleSuggestion('Laws of Motion')" class="p-6 bg-slate-800/40 border border-indigo-500/20 rounded-3xl text-left hover:bg-slate-800 transition-all group shadow-xl">
                            <div class="bg-indigo-500/10 text-indigo-400 w-10 h-10 rounded-xl flex items-center justify-center mb-4"><svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M13 2L3 14h9l-1 8 10-12h-9l1-8z"/></svg></div>
                            <h3 class="font-bold text-white mb-1">Laws of Motion</h3>
                            <p class="text-xs text-slate-500 leading-relaxed">Deep dive into kinematics.</p>
                        </button>
                        <button onclick="handleSuggestion('Thermodynamics')" class="p-6 bg-slate-800/40 border border-emerald-500/20 rounded-3xl text-left hover:bg-slate-800 transition-all group shadow-xl">
                            <div class="bg-emerald-500/10 text-emerald-400 w-10 h-10 rounded-xl flex items-center justify-center mb-4"><svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="1"/><path d="M20.2 20.2c2.04-2.03.02-7.36-4.5-11.9s-9.87-6.54-11.9-4.5c-2.04 2.03-.02 7.36 4.5 11.9s9.87 6.54 11.9 4.5Z"/></svg></div>
                            <h3 class="font-bold text-white mb-1">Thermodynamics</h3>
                            <p class="text-xs text-slate-500 leading-relaxed">Entropy and Heat laws.</p>
                        </button>
                        <button onclick="handleSuggestion('Organic Chemistry')" class="p-6 bg-slate-800/40 border border-cyan-500/20 rounded-3xl text-left hover:bg-slate-800 transition-all group shadow-xl">
                            <div class="bg-cyan-500/10 text-cyan-400 w-10 h-10 rounded-xl flex items-center justify-center mb-4"><svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 2v8L4.72 20.55a1 1 0 0 0 .9 1.45h12.76a1 1 0 0 0 .9-1.45L14 10V2"/></svg></div>
                            <h3 class="font-bold text-white mb-1">Organic Chem</h3>
                            <p class="text-xs text-slate-500 leading-relaxed">Hydrocarbons and reactions.</p>
                        </button>
                        <button onclick="handleSuggestion('Numerical Problems')" class="p-6 bg-slate-800/40 border border-purple-500/20 rounded-3xl text-left hover:bg-slate-800 transition-all group shadow-xl">
                            <div class="bg-purple-500/10 text-purple-400 w-10 h-10 rounded-xl flex items-center justify-center mb-4"><svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M9.59 4.59A2 2 0 1 1 11 8H2m10.59 11.41A2 2 0 1 0 14 16H2m15.73-8.27A2.5 2.5 0 1 1 19.5 12H2"/></svg></div>
                            <h3 class="font-bold text-white mb-1">Numericals</h3>
                            <p class="text-xs text-slate-500 leading-relaxed">Step-by-step solutions.</p>
                        </button>
                    </div>

                    <div class="mt-12 flex flex-col items-center justify-center p-12 bg-indigo-500/5 border-2 border-dashed border-indigo-500/20 rounded-[2.5rem]">
                        <div class="w-16 h-16 bg-[#0F172A] rounded-full flex items-center justify-center text-emerald-400 shadow-2xl mb-4 border border-slate-700">
                            <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="m12 3-1.912 5.813a2 2 0 0 1-1.275 1.275L3 12l5.813 1.912a2 2 0 0 1 1.275 1.275L12 21l1.912-5.813a2 2 0 0 1 1.275-1.275L21 12l-5.813-1.912a2 2 0 0 1-1.275-1.275L12 3Z"/><path d="M5 3v4"/><path d="M3 5h4"/><path d="M21 17v4"/><path d="M19 19h4"/></svg>
                        </div>
                        <p class="text-slate-400 font-medium text-center max-w-sm italic leading-relaxed">
                            "Somewhere, something incredible is waiting to be known."
                        </p>
                        <span class="text-[10px] text-emerald-500 mt-4 font-bold uppercase tracking-[0.3em]">â€” Carl Sagan</span>
                    </div>
                </div>

                <!-- Messages Thread -->
                <div id="messages-thread" class="max-w-4xl mx-auto space-y-8 pb-10"></div>
            </div>

            <!-- Input Bar -->
            <footer class="p-8 pt-2 bg-gradient-to-t from-[#0F172A] via-[#0F172A] to-transparent">
                <div class="max-w-4xl mx-auto">
                    <div class="relative group">
                        <div class="absolute inset-0 bg-indigo-500/10 rounded-3xl blur-2xl opacity-0 group-focus-within:opacity-100 transition duration-500"></div>
                        <div class="relative flex items-center bg-[#1E293B]/80 backdrop-blur-xl border border-slate-700/50 rounded-[1.75rem] shadow-2xl p-2 focus-within:ring-2 ring-indigo-500/30 transition-all">
                            <div class="px-4 text-slate-500 hidden sm:block border-r border-slate-700/50 mr-2">
                                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="hover:text-emerald-400 cursor-pointer transition-colors"><path d="M12 2a3 3 0 0 0-3 3v7a3 3 0 0 0 6 0V5a3 3 0 0 0-3-3Z"/><path d="M19 10v2a7 7 0 0 1-14 0v-2"/><line x1="12" y1="19" x2="12" y2="22"/></svg>
                            </div>
                            <input id="chat-input" type="text" placeholder="Ask about atomic structures or kinematics..." class="w-full bg-transparent px-2 py-4 outline-none text-white placeholder:text-slate-500 text-sm font-medium">
                            <button id="send-btn" class="px-6 py-4 rounded-2xl flex items-center justify-center gap-2 bg-slate-800 text-slate-500 transition-all transform active:scale-95">
                                <span class="text-sm font-bold hidden sm:block uppercase tracking-wider">Execute</span>
                                <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="22" y1="2" x2="11" y2="13"/><polyline points="22 2 15 22 11 13 2 9 22 2"/></svg>
                            </button>
                        </div>
                    </div>
                    
                    <div class="mt-4 flex items-center justify-between px-2 text-[10px] font-bold text-slate-500 uppercase tracking-widest">
                        <div class="flex gap-4">
                            <span class="flex items-center gap-1.5"><svg xmlns="http://www.w3.org/2000/svg" width="10" height="10" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="text-emerald-500"><path d="M13 2L3 14h9l-1 8 10-12h-9l1-8z"/></svg> Hybrid Core v3</span>
                            <span class="flex items-center gap-1.5"><svg xmlns="http://www.w3.org/2000/svg" width="10" height="10" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="text-indigo-400"><path d="M9.59 4.59A2 2 0 1 1 11 8H2m10.59 11.41A2 2 0 1 0 14 16H2m15.73-8.27A2.5 2.5 0 1 1 19.5 12H2"/></svg> Synapse Matrix</span>
                        </div>
                        <p>VITB Institutional Portal</p>
                    </div>
                </div>
            </footer>
        </main>
    </div>

    <script>
        const chatInput = document.getElementById('chat-input');
const sendBtn = document.getElementById('send-btn');
const messagesThread = document.getElementById('messages-thread');
const welcomeScreen = document.getElementById('welcome-screen');
const chatContainer = document.getElementById('chat-container');
const sidebar = document.getElementById('sidebar');
const toggleSidebar = document.getElementById('toggle-sidebar');
const clearChat = document.getElementById('clear-chat');

let isLoading = false;

const getTimestamp = () => new Date().toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });

// Update Button UI based on input
chatInput.addEventListener('input', () => {
    const hasValue = chatInput.value.trim().length > 0;
    if (hasValue && !isLoading) {
        sendBtn.classList.remove('bg-slate-800', 'text-slate-500');
        sendBtn.classList.add('bg-indigo-600', 'text-white', 'shadow-lg', 'shadow-indigo-500/20');
    } else {
        sendBtn.classList.add('bg-slate-800', 'text-slate-500');
        sendBtn.classList.remove('bg-indigo-600', 'text-white', 'shadow-lg', 'shadow-indigo-500/20');
    }
});

const appendMessage = (role, content) => {
    welcomeScreen.classList.add('hidden');
    const isUser = role === 'user';
    
    const messageDiv = document.createElement('div');
    messageDiv.className = `flex ${isUser ? 'justify-end' : 'justify-start'} animate-fade-in`;
    
    messageDiv.innerHTML = `
        <div class="flex gap-4 max-w-[85%] ${isUser ? 'flex-row-reverse' : 'flex-row'}">
            <div class="w-10 h-10 rounded-2xl flex-shrink-0 flex items-center justify-center shadow-lg border ${isUser ? 'bg-indigo-600 text-white border-indigo-500' : 'bg-slate-800 text-emerald-400 border-slate-700'}">
                ${isUser ? 
                    `<svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2"/><circle cx="12" cy="7" r="4"/></svg>` : 
                    `<svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 8V4H8"/><rect width="16" height="12" x="4" y="8" rx="2"/><path d="M2 14h2"/><path d="M20 14h2"/><path d="M15 13v2"/><path d="M9 13v2"/></svg>`}
            </div>
            <div class="p-5 rounded-[1.5rem] text-[15px] leading-relaxed shadow-2xl ${isUser ? 'chat-bubble-user text-white' : 'chat-bubble-bot text-slate-200'}">
                ${content}
                <div class="text-[9px] mt-3 font-bold uppercase tracking-widest opacity-40 ${isUser ? 'text-right' : 'text-left'}">
                    ${getTimestamp()}
                </div>
            </div>
        </div>
    `;
    
    messagesThread.appendChild(messageDiv);
    chatContainer.scrollTop = chatContainer.scrollHeight;
};

const showLoading = () => {
    const loadingDiv = document.createElement('div');
    loadingDiv.id = 'loading-bubble';
    loadingDiv.className = 'flex justify-start animate-fade-in';
    loadingDiv.innerHTML = `
        <div class="flex gap-4 items-center ml-14">
          <div class="flex gap-1.5 p-4 px-6 bg-slate-800 border border-slate-700 rounded-full shadow-2xl">
            <div class="w-1.5 h-1.5 bg-emerald-500 rounded-full animate-bounce"></div>
            <div class="w-1.5 h-1.5 bg-emerald-500 rounded-full animate-bounce" style="animation-delay: 0.2s"></div>
            <div class="w-1.5 h-1.5 bg-emerald-500 rounded-full animate-bounce" style="animation-delay: 0.4s"></div>
          </div>
        </div>
    `;
    messagesThread.appendChild(loadingDiv);
    chatContainer.scrollTop = chatContainer.scrollHeight;
};

const removeLoading = () => {
    const loader = document.getElementById('loading-bubble');
    if (loader) loader.remove();
};

// FIXED: Clean handleSend function (no longer nested)
async function handleSend(text = null) {
    const query = text || chatInput.value.trim();
    if (!query || isLoading) return;

    isLoading = true;
    chatInput.value = '';
    appendMessage('user', query);
    showLoading();

    try {
        const response = await fetch('/chat', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ message: query })
        });

        const data = await response.json();
        const botText = data.reply || "Academic server unresponsive. Please retry.";
        
        removeLoading();
        appendMessage('assistant', botText.replace(/\n/g, '<br>'));
    } catch (error) {
        removeLoading();
        appendMessage('assistant', "System error. The academic matrix is offline.");
        console.error("Fetch error:", error);
    } finally {
        isLoading = false;
        chatInput.dispatchEvent(new Event('input'));
    }
}

window.handleSuggestion = (text) => handleSend(text);

sendBtn.addEventListener('click', () => handleSend());
chatInput.addEventListener('keypress', (e) => {
    if (e.key === 'Enter') handleSend();
});

toggleSidebar.addEventListener('click', () => {
    sidebar.classList.toggle('-translate-x-full');
});

clearChat.addEventListener('click', () => {
    messagesThread.innerHTML = '';
    welcomeScreen.classList.remove('hidden');
});
    </script>
</body>
</html>